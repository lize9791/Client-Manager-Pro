const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-CCNOjCvE.js","assets/vue-vendor-ChRmxV0E.js","assets/helpers-CM6_8sGB.js","assets/naive-ui-C-WnQlxP.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/supabase-BxUUOEWR.js","assets/Login-DSun2xSl.css","assets/MainLayout-cjUm8x6p.js","assets/CustomerFormModal.vue_vue_type_script_setup_true_lang-XeaidfHL.js","assets/customer-BPUWG0Bc.js","assets/StatsChartOutline-MKDoyLsD.js","assets/DocumentTextOutline-DEN2-gad.js","assets/SearchOutline-DUsqMxOm.js","assets/MainLayout-Djv76iEb.css","assets/Dashboard-BvUAyzqR.js","assets/TimeOutline-CuTywy_j.js","assets/Dashboard-DnWHpWG7.css","assets/Customers-DxNcQ_io.js","assets/excel-CPbvKKXA.js","assets/Customers-aOfC-jNo.css","assets/CustomerDetail-BTSk2EQr.js","assets/CustomerDetail-B_Ri0xd0.css","assets/Orders-D2nR757Y.js","assets/Orders-rOFwk0AH.css","assets/Reports-CDPAMfOe.js","assets/Reports-FJVRDM2r.css","assets/Settings-BMLcAU1C.js","assets/Settings-Br-2FF6o.css"])))=>i.map(i=>d[i]);
import{S as T,r as b,c as v,U,V as D,k as V,W as q,N as E,X as M,Y as j,Z as w,_ as A,M as z,$ as F}from"./vue-vendor-ChRmxV0E.js";import{c as J}from"./supabase-BxUUOEWR.js";import{N as B,a as H,b as k,c as W,n as Z}from"./naive-ui-C-WnQlxP.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))m(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&m(i)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function m(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}})();const Q="modulepreload",X=function(r){return"/Client-Manager-Pro/"+r},L={},_=function(c,t,m){let e=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),s=i?.nonce||i?.getAttribute("nonce");e=Promise.allSettled(t.map(d=>{if(d=X(d),d in L)return;L[d]=!0;const h=d.endsWith(".css"),S=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${S}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":Q,h||(f.as="script"),f.crossOrigin="",f.href=d,s&&f.setAttribute("nonce",s),document.head.appendChild(f),h)return new Promise((I,O)=>{f.addEventListener("load",I),f.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(i){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i}return e.then(i=>{for(const s of i||[])s.status==="rejected"&&o(s.reason);return c().catch(o)})},Y="https://pqbneojpksizuigsglce.supabase.co",$="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxYm5lb2pwa3NpenVpZ3NnbGNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyODcxMDgsImV4cCI6MjA3Njg2MzEwOH0.lr8G6dn2nTQy4pPQKb7HgVw8Imms71QjDEAPJjB-rjg",p=J(Y,$,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),se={CUSTOMERS:"customers",ORDERS:"orders",FOLLOWUPS:"followups",ATTACHMENTS:"attachments",USERS:"users"},N=T("auth",()=>{const r=b(null),c=b(null),t=b(!1),m=v(()=>!!r.value),e=v(()=>r.value?.role||"viewer"),o=v(()=>e.value==="admin"),i=v(()=>e.value==="sales"),s=v(()=>e.value==="viewer");async function d(){t.value=!0;try{const{data:{session:n}}=await p.auth.getSession();n&&(c.value=n,await h(n.user.id)),p.auth.onAuthStateChange(async(l,a)=>{c.value=a,a?.user?await h(a.user.id):r.value=null})}catch(n){console.error("Failed to initialize auth:",n)}finally{t.value=!1}}async function h(n){try{const{data:l,error:a}=await p.from("users").select("*").eq("id",n).maybeSingle();if(a)throw a;if(l)r.value=l;else{const u=(await p.auth.getUser()).data.user;if(u){const y={id:u.id,email:u.email,name:u.user_metadata?.name||u.email.split("@")[0],role:"sales"},{data:g,error:C}=await p.from("users").insert(y).select().single();C?console.error("Failed to create user profile:",C):r.value=g}}}catch(l){console.error("Failed to fetch user profile:",l)}}async function S(n,l){t.value=!0;try{const{data:a,error:u}=await p.auth.signInWithPassword({email:n,password:l});return u||(c.value=a.session,a.user&&await h(a.user.id),null)}catch(a){return console.error("Sign in error:",a),a}finally{t.value=!1}}async function f(n,l,a){t.value=!0;try{const{data:u,error:y}=await p.auth.signUp({email:n,password:l,options:{data:{name:a}}});if(y)return y;if(u.user){const{error:g}=await p.from("users").insert({id:u.user.id,email:u.user.email,name:a||n.split("@")[0],role:"sales"});g&&console.error("Failed to create user profile:",g)}return null}catch(u){return console.error("Sign up error:",u),u}finally{t.value=!1}}async function I(){t.value=!0;try{await p.auth.signOut(),r.value=null,c.value=null}catch(n){console.error("Sign out error:",n)}finally{t.value=!1}}async function O(n){if(!r.value)return!1;try{const{error:l}=await p.from("users").update(n).eq("id",r.value.id);if(l)throw l;return r.value={...r.value,...n},!0}catch(l){return console.error("Update profile error:",l),!1}}return{user:r,session:c,loading:t,isAuthenticated:m,userRole:e,isAdmin:o,isSales:i,isViewer:s,initialize:d,signIn:S,signUp:f,signOut:I,updateProfile:O}}),G=[{path:"/login",name:"Login",component:()=>_(()=>import("./Login-CCNOjCvE.js"),__vite__mapDeps([0,1,2,3,4,5,6])),meta:{requiresAuth:!1}},{path:"/",component:()=>_(()=>import("./MainLayout-cjUm8x6p.js"),__vite__mapDeps([7,1,2,8,9,3,10,11,12,4,5,13])),meta:{requiresAuth:!0},children:[{path:"",name:"Dashboard",component:()=>_(()=>import("./Dashboard-BvUAyzqR.js"),__vite__mapDeps([14,1,2,3,10,15,4,5,16]))},{path:"customers",name:"Customers",component:()=>_(()=>import("./Customers-DxNcQ_io.js"),__vite__mapDeps([17,1,9,2,8,3,18,4,12,5,19]))},{path:"customers/:id",name:"CustomerDetail",component:()=>_(()=>import("./CustomerDetail-BTSk2EQr.js"),__vite__mapDeps([20,1,9,2,8,3,4,5,21]))},{path:"orders",name:"Orders",component:()=>_(()=>import("./Orders-D2nR757Y.js"),__vite__mapDeps([22,1,9,2,3,12,11,15,4,5,23]))},{path:"reports",name:"Reports",component:()=>_(()=>import("./Reports-CDPAMfOe.js"),__vite__mapDeps([24,1,3,4,25]))},{path:"settings",name:"Settings",component:()=>_(()=>import("./Settings-BMLcAU1C.js"),__vite__mapDeps([26,1,3,4,27])),meta:{requiresAdmin:!0}}]}],R=U({history:D(),routes:G});R.beforeEach(async(r,c,t)=>{const m=N();let e=0;for(;m.loading&&e<30;)await new Promise(s=>setTimeout(s,100)),e++;const o=r.matched.some(s=>s.meta.requiresAuth!==!1),i=r.matched.some(s=>s.meta.requiresAdmin);o&&!m.isAuthenticated?t({name:"Login",query:{redirect:r.fullPath}}):i&&!m.isAdmin?t({name:"Dashboard"}):r.name==="Login"&&m.isAuthenticated?t({name:"Dashboard"}):t()});const K=V({__name:"App",setup(r){const c={common:{primaryColor:"#18a058",primaryColorHover:"#36ad6a",primaryColorPressed:"#0c7a43",primaryColorSuppl:"#36ad6a"}};return(t,m)=>{const e=M("router-view");return j(),q(E(B),{"theme-overrides":c},{default:w(()=>[A(E(H),null,{default:w(()=>[A(E(k),null,{default:w(()=>[A(E(W),null,{default:w(()=>[A(e)]),_:1})]),_:1})]),_:1})]),_:1})}}}),P=z(K),x=F();P.use(x);P.use(R);P.use(Z);const ee=N();ee.initialize().then(()=>{P.mount("#app")});export{se as T,_,p as s,N as u};
//# sourceMappingURL=index-Brpx9w6i.js.map
