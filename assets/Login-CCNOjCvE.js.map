{"version":3,"file":"Login-CCNOjCvE.js","sources":["../../src/views/Login.vue"],"sourcesContent":["<template>\n  <div class=\"login-container\">\n    <n-card class=\"login-card\" title=\"客户管理系统\" size=\"large\">\n      <n-tabs v-model:value=\"activeTab\" size=\"large\" animated>\n        <n-tab-pane name=\"login\" tab=\"登录\">\n          <n-form ref=\"loginFormRef\" :model=\"loginForm\" :rules=\"loginRules\" size=\"large\">\n            <n-form-item path=\"email\" label=\"邮箱\">\n              <n-input\n                v-model:value=\"loginForm.email\"\n                placeholder=\"请输入邮箱\"\n                @keyup.enter=\"handleLogin\"\n              />\n            </n-form-item>\n            <n-form-item path=\"password\" label=\"密码\">\n              <n-input\n                v-model:value=\"loginForm.password\"\n                type=\"password\"\n                show-password-on=\"click\"\n                placeholder=\"请输入密码\"\n                @keyup.enter=\"handleLogin\"\n              />\n            </n-form-item>\n            <n-button\n              type=\"primary\"\n              block\n              size=\"large\"\n              :loading=\"loading\"\n              @click=\"handleLogin\"\n            >\n              登录\n            </n-button>\n          </n-form>\n        </n-tab-pane>\n\n        <n-tab-pane name=\"register\" tab=\"注册\">\n          <n-form ref=\"registerFormRef\" :model=\"registerForm\" :rules=\"registerRules\" size=\"large\">\n            <n-form-item path=\"name\" label=\"姓名\">\n              <n-input v-model:value=\"registerForm.name\" placeholder=\"请输入姓名\" />\n            </n-form-item>\n            <n-form-item path=\"email\" label=\"邮箱\">\n              <n-input v-model:value=\"registerForm.email\" placeholder=\"请输入邮箱\" />\n            </n-form-item>\n            <n-form-item path=\"password\" label=\"密码\">\n              <n-input\n                v-model:value=\"registerForm.password\"\n                type=\"password\"\n                show-password-on=\"click\"\n                placeholder=\"请输入密码（至少6位）\"\n              />\n            </n-form-item>\n            <n-form-item path=\"confirmPassword\" label=\"确认密码\">\n              <n-input\n                v-model:value=\"registerForm.confirmPassword\"\n                type=\"password\"\n                show-password-on=\"click\"\n                placeholder=\"请再次输入密码\"\n                @keyup.enter=\"handleRegister\"\n              />\n            </n-form-item>\n            <n-button\n              type=\"primary\"\n              block\n              size=\"large\"\n              :loading=\"loading\"\n              @click=\"handleRegister\"\n            >\n              注册\n            </n-button>\n          </n-form>\n        </n-tab-pane>\n      </n-tabs>\n    </n-card>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { NCard, NTabs, NTabPane, NForm, NFormItem, NInput, NButton, useMessage } from 'naive-ui'\nimport type { FormInst, FormRules } from 'naive-ui'\nimport { useAuthStore } from '@/stores/auth'\nimport { validateEmail } from '@/utils/helpers'\n\nconst router = useRouter()\nconst message = useMessage()\nconst authStore = useAuthStore()\n\nconst activeTab = ref('login')\nconst loading = ref(false)\n\nconst loginFormRef = ref<FormInst | null>(null)\nconst loginForm = ref({\n  email: '',\n  password: ''\n})\n\nconst registerFormRef = ref<FormInst | null>(null)\nconst registerForm = ref({\n  name: '',\n  email: '',\n  password: '',\n  confirmPassword: ''\n})\n\nconst loginRules: FormRules = {\n  email: [\n    { required: true, message: '请输入邮箱', trigger: 'blur' },\n    {\n      validator: (rule, value) => validateEmail(value),\n      message: '请输入有效的邮箱地址',\n      trigger: 'blur'\n    }\n  ],\n  password: [{ required: true, message: '请输入密码', trigger: 'blur' }]\n}\n\nconst registerRules: FormRules = {\n  name: [{ required: true, message: '请输入姓名', trigger: 'blur' }],\n  email: [\n    { required: true, message: '请输入邮箱', trigger: 'blur' },\n    {\n      validator: (rule, value) => validateEmail(value),\n      message: '请输入有效的邮箱地址',\n      trigger: 'blur'\n    }\n  ],\n  password: [\n    { required: true, message: '请输入密码', trigger: 'blur' },\n    { min: 6, message: '密码至少6位', trigger: 'blur' }\n  ],\n  confirmPassword: [\n    { required: true, message: '请确认密码', trigger: 'blur' },\n    {\n      validator: (rule, value) => value === registerForm.value.password,\n      message: '两次输入的密码不一致',\n      trigger: 'blur'\n    }\n  ]\n}\n\nasync function handleLogin() {\n  if (!loginFormRef.value) return\n\n  try {\n    await loginFormRef.value.validate()\n    loading.value = true\n\n    const error = await authStore.signIn(loginForm.value.email, loginForm.value.password)\n\n    if (error) {\n      message.error(error.message || '登录失败')\n    } else {\n      // 等待用户状态加载完成\n      let waitCount = 0\n      while (!authStore.user && waitCount < 20) {\n        await new Promise(resolve => setTimeout(resolve, 100))\n        waitCount++\n      }\n\n      if (authStore.user) {\n        message.success('登录成功')\n        // 使用 replace 避免返回到登录页\n        await router.replace({ name: 'Dashboard' })\n      } else {\n        message.error('登录失败：无法获取用户信息')\n      }\n    }\n  } catch (e) {\n    // 表单验证失败\n  } finally {\n    loading.value = false\n  }\n}\n\nasync function handleRegister() {\n  if (!registerFormRef.value) return\n\n  try {\n    await registerFormRef.value.validate()\n    loading.value = true\n\n    const error = await authStore.signUp(\n      registerForm.value.email,\n      registerForm.value.password,\n      registerForm.value.name\n    )\n\n    if (error) {\n      message.error(error.message || '注册失败')\n    } else {\n      message.success('注册成功，请检查邮箱进行验证')\n      activeTab.value = 'login'\n      loginForm.value.email = registerForm.value.email\n    }\n  } catch (e) {\n    // 表单验证失败\n  } finally {\n    loading.value = false\n  }\n}\n</script>\n\n<style scoped>\n.login-container {\n  width: 100%;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n}\n\n.login-card {\n  width: 450px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n}\n</style>\n"],"names":["router","useRouter","message","useMessage","authStore","useAuthStore","activeTab","ref","loading","loginFormRef","loginForm","registerFormRef","registerForm","loginRules","rule","value","validateEmail","registerRules","handleLogin","error","waitCount","resolve","handleRegister","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_unref","NCard","NTabs","$event","NTabPane","NForm","NFormItem","NInput","_cache","NButton"],"mappings":"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"}