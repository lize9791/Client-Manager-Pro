import{k as D,a0 as w,Y as i,a3 as p,r as y,o as R,_ as a,Z as t,N as e,a4 as V,a1 as z,W as m,a7 as S,j as o,a5 as r,F as O,R as U}from"./vue-vendor-ChRmxV0E.js";import{u as W}from"./customer-BPUWG0Bc.js";import{c as Y,g as Z,a as q,f as k,b as P}from"./helpers-CM6_8sGB.js";import{_ as X}from"./CustomerFormModal.vue_vue_type_script_setup_true_lang-XeaidfHL.js";import{W as G,u as H,Y as J,y as b,B as c,j as K,Z as Q,_ as u,z as B,X as ee,d as C,t as T,R as te,$ as ae,E as le,a0 as se}from"./naive-ui-C-WnQlxP.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Brpx9w6i.js";import"./supabase-BxUUOEWR.js";const re={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ne=D({name:"ArrowBackOutline",render:function(f,v){return i(),w("svg",re,v[0]||(v[0]=[p("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M244 400L100 256l144-144"},null,-1),p("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M120 256h292"},null,-1)]))}}),ue={class:"customer-detail-view"},ie={key:0},de=D({__name:"CustomerDetail",setup($){const f=z(),v=V(),E=G(),g=H(),h=W(),l=y(null),_=y(!1),I=y(!1),L=y(!1),M=[{title:"订单号",key:"order_no"},{title:"产品",key:"product"},{title:"利润",key:"profit"},{title:"状态",key:"status"},{title:"创建日期",key:"create_date",render:d=>k(d.create_date)}];function x(d){return{email:"info",phone:"success",whatsapp:"success",wechat:"success",meeting:"warning",other:"default"}[d]||"default"}function j(){_.value=!0}function A(){l.value&&E.warning({title:"确认删除",content:`确定要删除客户 "${l.value.company}" 吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await h.deleteCustomer(l.value.id),g.success("删除成功"),f.push({name:"Customers"})}catch(d){g.error(d?.message||"删除失败")}}})}async function F(){_.value=!1,await N()}async function N(){const d=v.params.id;l.value=await h.fetchCustomerById(d),l.value||(g.error("客户不存在"),f.push({name:"Customers"}))}return R(()=>{N()}),(d,s)=>(i(),w("div",ue,[a(e(J),{show:e(h).loading},{default:t(()=>[a(e(b),{vertical:"",size:"large"},{default:t(()=>[a(e(c),{text:"",onClick:s[0]||(s[0]=n=>e(f).back())},{icon:t(()=>[a(e(K),{component:e(ne)},null,8,["component"])]),default:t(()=>[s[4]||(s[4]=o(" 返回 ",-1))]),_:1}),l.value?(i(),m(e(C),{key:0,title:"客户信息"},{"header-extra":t(()=>[a(e(b),null,{default:t(()=>[a(e(c),{onClick:j},{default:t(()=>[...s[5]||(s[5]=[o("编辑",-1)])]),_:1}),a(e(c),{type:"error",onClick:A},{default:t(()=>[...s[6]||(s[6]=[o("删除",-1)])]),_:1})]),_:1})]),default:t(()=>[a(e(Q),{column:3,bordered:""},{default:t(()=>[a(e(u),{label:"客户单号"},{default:t(()=>[o(r(l.value.code),1)]),_:1}),a(e(u),{label:"公司"},{default:t(()=>[o(r(l.value.company),1)]),_:1}),a(e(u),{label:"联系人"},{default:t(()=>[o(r(l.value.contact),1)]),_:1}),a(e(u),{label:"国家"},{default:t(()=>[o(r(l.value.country),1)]),_:1}),a(e(u),{label:"产品"},{default:t(()=>[o(r(l.value.product),1)]),_:1}),a(e(u),{label:"状态"},{default:t(()=>[a(e(B),{type:e(Y)(l.value.status)},{default:t(()=>[o(r(e(Z)(l.value.status)),1)]),_:1},8,["type"])]),_:1}),a(e(u),{label:"邮箱"},{default:t(()=>[o(r(l.value.email||"-"),1)]),_:1}),a(e(u),{label:"电话"},{default:t(()=>[o(r(l.value.phone||"-"),1)]),_:1}),a(e(u),{label:"来源"},{default:t(()=>[o(r(e(q)(l.value.source)),1)]),_:1}),a(e(u),{label:"询盘日期"},{default:t(()=>[o(r(e(k)(l.value.inquiry_date)),1)]),_:1}),a(e(u),{label:"负责人"},{default:t(()=>[o(r(l.value.owner?.name||l.value.owner?.email),1)]),_:1}),a(e(u),{label:"是否录入"},{default:t(()=>[a(e(ee),{value:l.value.is_entered,disabled:""},null,8,["value"])]),_:1}),a(e(u),{label:"备注",span:3},{default:t(()=>[o(r(l.value.remark||"-"),1)]),_:1})]),_:1})]),_:1})):S("",!0),a(e(C),{title:"订单列表"},{"header-extra":t(()=>[a(e(c),{type:"primary",onClick:s[1]||(s[1]=n=>I.value=!0)},{default:t(()=>[...s[7]||(s[7]=[o("新增订单",-1)])]),_:1})]),default:t(()=>[!l.value?.orders||l.value.orders.length===0?(i(),m(e(T),{key:0,description:"暂无订单"})):(i(),m(e(te),{key:1,columns:M,data:l.value.orders,pagination:!1},null,8,["data"]))]),_:1}),a(e(C),{title:"跟进记录"},{"header-extra":t(()=>[a(e(c),{type:"primary",onClick:s[2]||(s[2]=n=>L.value=!0)},{default:t(()=>[...s[8]||(s[8]=[o("添加跟进",-1)])]),_:1})]),default:t(()=>[!l.value?.followups||l.value.followups.length===0?(i(),m(e(T),{key:0,description:"暂无跟进记录"})):(i(),m(e(se),{key:1},{default:t(()=>[(i(!0),w(O,null,U(l.value.followups,n=>(i(),m(e(ae),{key:n.id,title:e(k)(n.follow_date),type:x(n.method)},{header:t(()=>[a(e(b),null,{default:t(()=>[p("span",null,r(e(k)(n.follow_date)),1),a(e(B),{size:"small",type:x(n.method)},{default:t(()=>[o(r(e(P)(n.method)),1)]),_:2},1032,["type"])]),_:2},1024)]),default:t(()=>[p("p",null,r(n.content),1),n.next_plan?(i(),w("p",ie,[s[9]||(s[9]=p("strong",null,"下一步计划：",-1)),o(r(n.next_plan),1)])):S("",!0),a(e(le),{depth:"3"},{default:t(()=>[o(" 跟进人："+r(n.follower?.name||n.follower?.email),1)]),_:2},1024)]),_:2},1032,["title","type"]))),128))]),_:1}))]),_:1})]),_:1})]),_:1},8,["show"]),a(X,{show:_.value,"onUpdate:show":s[3]||(s[3]=n=>_.value=n),customer:l.value,onSuccess:F},null,8,["show","customer"])]))}}),we=oe(de,[["__scopeId","data-v-802da408"]]);export{we as default};
//# sourceMappingURL=CustomerDetail-BTSk2EQr.js.map
