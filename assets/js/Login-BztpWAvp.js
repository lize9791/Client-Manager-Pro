import{k as e,r as a,a0 as l,_ as r,Z as s,N as u,Y as o,a1 as i,a2 as t,j as d}from"./vue-vendor-AGKXruha.js";import{u as n}from"./index-BcVpiwTF.js";import{v}from"./helpers-Ba1kvV6f.js";import{u as m,d as p,e as g,f as c,g as f,h as w,i as _,B as b}from"./naive-ui-DL6zjJD3.js";import{_ as h}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./supabase-BUHeOf8C.js";const y={class:"login-container"},k=h(e({__name:"Login",setup(e){const h=i(),k=m(),U=n(),j=a("login"),q=a(!1),z=a(null),P=a({email:"",password:""}),x=a(null),K=a({name:"",email:"",password:"",confirmPassword:""}),C={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(e,a)=>v(a),message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},F={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(e,a)=>v(a),message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a)=>a===K.value.password,message:"两次输入的密码不一致",trigger:"blur"}]};async function I(){if(z.value)try{await z.value.validate(),q.value=!0;const e=await U.signIn(P.value.email,P.value.password);if(e)k.error(e.message||"登录失败");else{let e=0;for(;!U.user&&e<20;)await new Promise(e=>setTimeout(e,100)),e++;U.user?(k.success("登录成功"),await h.replace({name:"Dashboard"})):k.error("登录失败：无法获取用户信息")}}catch(e){}finally{q.value=!1}}async function R(){if(x.value)try{await x.value.validate(),q.value=!0;const e=await U.signUp(K.value.email,K.value.password,K.value.name);e?k.error(e.message||"注册失败"):(k.success("注册成功，请检查邮箱进行验证"),j.value="login",P.value.email=K.value.email)}catch(e){}finally{q.value=!1}}return(e,a)=>(o(),l("div",y,[r(u(p),{class:"login-card",title:"客户管理系统",size:"large"},{default:s(()=>[r(u(g),{value:j.value,"onUpdate:value":a[6]||(a[6]=e=>j.value=e),size:"large",animated:""},{default:s(()=>[r(u(c),{name:"login",tab:"登录"},{default:s(()=>[r(u(f),{ref_key:"loginFormRef",ref:z,model:P.value,rules:C,size:"large"},{default:s(()=>[r(u(w),{path:"email",label:"邮箱"},{default:s(()=>[r(u(_),{value:P.value.email,"onUpdate:value":a[0]||(a[0]=e=>P.value.email=e),placeholder:"请输入邮箱",onKeyup:t(I,["enter"])},null,8,["value"])]),_:1}),r(u(w),{path:"password",label:"密码"},{default:s(()=>[r(u(_),{value:P.value.password,"onUpdate:value":a[1]||(a[1]=e=>P.value.password=e),type:"password","show-password-on":"click",placeholder:"请输入密码",onKeyup:t(I,["enter"])},null,8,["value"])]),_:1}),r(u(b),{type:"primary",block:"",size:"large",loading:q.value,onClick:I},{default:s(()=>[...a[7]||(a[7]=[d(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1}),r(u(c),{name:"register",tab:"注册"},{default:s(()=>[r(u(f),{ref_key:"registerFormRef",ref:x,model:K.value,rules:F,size:"large"},{default:s(()=>[r(u(w),{path:"name",label:"姓名"},{default:s(()=>[r(u(_),{value:K.value.name,"onUpdate:value":a[2]||(a[2]=e=>K.value.name=e),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),r(u(w),{path:"email",label:"邮箱"},{default:s(()=>[r(u(_),{value:K.value.email,"onUpdate:value":a[3]||(a[3]=e=>K.value.email=e),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),r(u(w),{path:"password",label:"密码"},{default:s(()=>[r(u(_),{value:K.value.password,"onUpdate:value":a[4]||(a[4]=e=>K.value.password=e),type:"password","show-password-on":"click",placeholder:"请输入密码（至少6位）"},null,8,["value"])]),_:1}),r(u(w),{path:"confirmPassword",label:"确认密码"},{default:s(()=>[r(u(_),{value:K.value.confirmPassword,"onUpdate:value":a[5]||(a[5]=e=>K.value.confirmPassword=e),type:"password","show-password-on":"click",placeholder:"请再次输入密码",onKeyup:t(R,["enter"])},null,8,["value"])]),_:1}),r(u(b),{type:"primary",block:"",size:"large",loading:q.value,onClick:R},{default:s(()=>[...a[8]||(a[8]=[d(" 注册 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1})]),_:1},8,["value"])]),_:1})]))}}),[["__scopeId","data-v-eed9eefb"]]);export{k as default};
