import{k as q,r as n,a0 as z,_ as a,Z as o,N as l,Y as C,a1 as x,a2 as b,j as _}from"./vue-vendor-ChRmxV0E.js";import{u as T}from"./index-LEjS_y3d.js";import{v as k}from"./helpers-CM6_8sGB.js";import{u as B,d as I,e as K,f as h,g as N,h as d,i as m,B as F}from"./naive-ui-C-WnQlxP.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./supabase-BxUUOEWR.js";const E={class:"login-container"},S=q({__name:"Login",setup(V){const R=x(),g=B(),v=T(),p=n("login"),i=n(!1),f=n(null),u=n({email:"",password:""}),w=n(null),s=n({name:"",email:"",password:"",confirmPassword:""}),U={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(t,e)=>k(e),message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},P={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(t,e)=>k(e),message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(t,e)=>e===s.value.password,message:"两次输入的密码不一致",trigger:"blur"}]};async function c(){if(f.value)try{await f.value.validate(),i.value=!0;const t=await v.signIn(u.value.email,u.value.password);if(t)g.error(t.message||"登录失败");else{let e=0;for(;!v.user&&e<20;)await new Promise(r=>setTimeout(r,100)),e++;v.user?(g.success("登录成功"),await R.replace({name:"Dashboard"})):g.error("登录失败：无法获取用户信息")}}catch{}finally{i.value=!1}}async function y(){if(w.value)try{await w.value.validate(),i.value=!0;const t=await v.signUp(s.value.email,s.value.password,s.value.name);t?g.error(t.message||"注册失败"):(g.success("注册成功，请检查邮箱进行验证"),p.value="login",u.value.email=s.value.email)}catch{}finally{i.value=!1}}return(t,e)=>(C(),z("div",E,[a(l(I),{class:"login-card",title:"客户管理系统",size:"large"},{default:o(()=>[a(l(K),{value:p.value,"onUpdate:value":e[6]||(e[6]=r=>p.value=r),size:"large",animated:""},{default:o(()=>[a(l(h),{name:"login",tab:"登录"},{default:o(()=>[a(l(N),{ref_key:"loginFormRef",ref:f,model:u.value,rules:U,size:"large"},{default:o(()=>[a(l(d),{path:"email",label:"邮箱"},{default:o(()=>[a(l(m),{value:u.value.email,"onUpdate:value":e[0]||(e[0]=r=>u.value.email=r),placeholder:"请输入邮箱",onKeyup:b(c,["enter"])},null,8,["value"])]),_:1}),a(l(d),{path:"password",label:"密码"},{default:o(()=>[a(l(m),{value:u.value.password,"onUpdate:value":e[1]||(e[1]=r=>u.value.password=r),type:"password","show-password-on":"click",placeholder:"请输入密码",onKeyup:b(c,["enter"])},null,8,["value"])]),_:1}),a(l(F),{type:"primary",block:"",size:"large",loading:i.value,onClick:c},{default:o(()=>[...e[7]||(e[7]=[_(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1}),a(l(h),{name:"register",tab:"注册"},{default:o(()=>[a(l(N),{ref_key:"registerFormRef",ref:w,model:s.value,rules:P,size:"large"},{default:o(()=>[a(l(d),{path:"name",label:"姓名"},{default:o(()=>[a(l(m),{value:s.value.name,"onUpdate:value":e[2]||(e[2]=r=>s.value.name=r),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),a(l(d),{path:"email",label:"邮箱"},{default:o(()=>[a(l(m),{value:s.value.email,"onUpdate:value":e[3]||(e[3]=r=>s.value.email=r),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),a(l(d),{path:"password",label:"密码"},{default:o(()=>[a(l(m),{value:s.value.password,"onUpdate:value":e[4]||(e[4]=r=>s.value.password=r),type:"password","show-password-on":"click",placeholder:"请输入密码（至少6位）"},null,8,["value"])]),_:1}),a(l(d),{path:"confirmPassword",label:"确认密码"},{default:o(()=>[a(l(m),{value:s.value.confirmPassword,"onUpdate:value":e[5]||(e[5]=r=>s.value.confirmPassword=r),type:"password","show-password-on":"click",placeholder:"请再次输入密码",onKeyup:b(y,["enter"])},null,8,["value"])]),_:1}),a(l(F),{type:"primary",block:"",size:"large",loading:i.value,onClick:y},{default:o(()=>[...e[8]||(e[8]=[_(" 注册 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1})]),_:1},8,["value"])]),_:1})]))}}),G=L(S,[["__scopeId","data-v-eed9eefb"]]);export{G as default};
