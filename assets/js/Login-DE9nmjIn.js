import{d as e,u as a,a as l,r,c as s,b as u,w as o,e as i,N as t,o as d,f as n,g as v,h as m,i as p,j as g,k as c,l as f,B as w,m as b}from"./index-BgS45tSZ.js";import{v as _}from"./helpers-Ba1kvV6f.js";import{_ as h}from"./_plugin-vue_export-helper-BCo6x5W8.js";const y={class:"login-container"},k=h(e({__name:"Login",setup(e){const h=n(),k=a(),U=l(),q=r("login"),z=r(!1),P=r(null),j=r({email:"",password:""}),x=r(null),K=r({name:"",email:"",password:"",confirmPassword:""}),C={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(e,a)=>_(a),message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},F={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(e,a)=>_(a),message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,a)=>a===K.value.password,message:"两次输入的密码不一致",trigger:"blur"}]};async function I(){if(P.value)try{await P.value.validate(),z.value=!0;const e=await U.signIn(j.value.email,j.value.password);if(e)k.error(e.message||"登录失败");else{let e=0;for(;!U.user&&e<20;)await new Promise(e=>setTimeout(e,100)),e++;U.user?(k.success("登录成功"),await h.replace({name:"Dashboard"})):k.error("登录失败：无法获取用户信息")}}catch(e){}finally{z.value=!1}}async function R(){if(x.value)try{await x.value.validate(),z.value=!0;const e=await U.signUp(K.value.email,K.value.password,K.value.name);e?k.error(e.message||"注册失败"):(k.success("注册成功，请检查邮箱进行验证"),q.value="login",j.value.email=K.value.email)}catch(e){}finally{z.value=!1}}return(e,a)=>(d(),s("div",y,[u(i(t),{class:"login-card",title:"客户管理系统",size:"large"},{default:o(()=>[u(i(v),{value:q.value,"onUpdate:value":a[6]||(a[6]=e=>q.value=e),size:"large",animated:""},{default:o(()=>[u(i(m),{name:"login",tab:"登录"},{default:o(()=>[u(i(p),{ref_key:"loginFormRef",ref:P,model:j.value,rules:C,size:"large"},{default:o(()=>[u(i(g),{path:"email",label:"邮箱"},{default:o(()=>[u(i(c),{value:j.value.email,"onUpdate:value":a[0]||(a[0]=e=>j.value.email=e),placeholder:"请输入邮箱",onKeyup:f(I,["enter"])},null,8,["value"])]),_:1}),u(i(g),{path:"password",label:"密码"},{default:o(()=>[u(i(c),{value:j.value.password,"onUpdate:value":a[1]||(a[1]=e=>j.value.password=e),type:"password","show-password-on":"click",placeholder:"请输入密码",onKeyup:f(I,["enter"])},null,8,["value"])]),_:1}),u(i(w),{type:"primary",block:"",size:"large",loading:z.value,onClick:I},{default:o(()=>[...a[7]||(a[7]=[b(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1}),u(i(m),{name:"register",tab:"注册"},{default:o(()=>[u(i(p),{ref_key:"registerFormRef",ref:x,model:K.value,rules:F,size:"large"},{default:o(()=>[u(i(g),{path:"name",label:"姓名"},{default:o(()=>[u(i(c),{value:K.value.name,"onUpdate:value":a[2]||(a[2]=e=>K.value.name=e),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),u(i(g),{path:"email",label:"邮箱"},{default:o(()=>[u(i(c),{value:K.value.email,"onUpdate:value":a[3]||(a[3]=e=>K.value.email=e),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),u(i(g),{path:"password",label:"密码"},{default:o(()=>[u(i(c),{value:K.value.password,"onUpdate:value":a[4]||(a[4]=e=>K.value.password=e),type:"password","show-password-on":"click",placeholder:"请输入密码（至少6位）"},null,8,["value"])]),_:1}),u(i(g),{path:"confirmPassword",label:"确认密码"},{default:o(()=>[u(i(c),{value:K.value.confirmPassword,"onUpdate:value":a[5]||(a[5]=e=>K.value.confirmPassword=e),type:"password","show-password-on":"click",placeholder:"请再次输入密码",onKeyup:f(R,["enter"])},null,8,["value"])]),_:1}),u(i(w),{type:"primary",block:"",size:"large",loading:z.value,onClick:R},{default:o(()=>[...a[8]||(a[8]=[b(" 注册 ",-1)])]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1})]),_:1},8,["value"])]),_:1})]))}}),[["__scopeId","data-v-b541d4c6"]]);export{k as default};
