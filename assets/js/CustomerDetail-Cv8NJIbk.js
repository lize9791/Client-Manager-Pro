import{k as e,a0 as a,Y as l,a3 as t,r as u,o as s,_ as o,Z as r,N as n,a4 as i,a1 as d,W as c,a7 as p,j as f,a5 as _,F as m,R as v}from"./vue-vendor-AGKXruha.js";import{u as w}from"./customer-DFMcG-Vh.js";import{c as y,g as h,a as k,f as g,b}from"./helpers-Ba1kvV6f.js";import{_ as x}from"./CustomerFormModal.vue_vue_type_script_setup_true_lang-CNOHx8k1.js";import{W as C,u as j,Y as B,y as z,B as M,j as F,Z as I,_ as R,z as T,X as W,d as Y,t as Z,R as $,$ as q,E as A,a0 as D}from"./naive-ui-DL6zjJD3.js";import{_ as E}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-BcVpiwTF.js";import"./supabase-BUHeOf8C.js";const L={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},N=e({name:"ArrowBackOutline",render:function(e,u){return l(),a("svg",L,u[0]||(u[0]=[t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M244 400L100 256l144-144"},null,-1),t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M120 256h292"},null,-1)]))}}),O={class:"customer-detail-view"},P={key:0},S=E(e({__name:"CustomerDetail",setup(e){const E=d(),L=i(),S=C(),U=j(),X=w(),G=u(null),H=u(!1),J=u(!1),K=u(!1),Q=[{title:"订单号",key:"order_no"},{title:"产品",key:"product"},{title:"利润",key:"profit"},{title:"状态",key:"status"},{title:"创建日期",key:"create_date",render:e=>g(e.create_date)}];function V(e){return{email:"info",phone:"success",whatsapp:"success",wechat:"success",meeting:"warning",other:"default"}[e]||"default"}function ee(){H.value=!0}function ae(){G.value&&S.warning({title:"确认删除",content:`确定要删除客户 "${G.value.company}" 吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await X.deleteCustomer(G.value.id),U.success("删除成功"),E.push({name:"Customers"})}catch(e){U.error(e?.message||"删除失败")}}})}async function le(){H.value=!1,await te()}async function te(){const e=L.params.id;G.value=await X.fetchCustomerById(e),G.value||(U.error("客户不存在"),E.push({name:"Customers"}))}return s(()=>{te()}),(e,u)=>(l(),a("div",O,[o(n(B),{show:n(X).loading},{default:r(()=>[o(n(z),{vertical:"",size:"large"},{default:r(()=>[o(n(M),{text:"",onClick:u[0]||(u[0]=e=>n(E).back())},{icon:r(()=>[o(n(F),{component:n(N)},null,8,["component"])]),default:r(()=>[u[4]||(u[4]=f(" 返回 ",-1))]),_:1}),G.value?(l(),c(n(Y),{key:0,title:"客户信息"},{"header-extra":r(()=>[o(n(z),null,{default:r(()=>[o(n(M),{onClick:ee},{default:r(()=>[...u[5]||(u[5]=[f("编辑",-1)])]),_:1}),o(n(M),{type:"error",onClick:ae},{default:r(()=>[...u[6]||(u[6]=[f("删除",-1)])]),_:1})]),_:1})]),default:r(()=>[o(n(I),{column:3,bordered:""},{default:r(()=>[o(n(R),{label:"客户单号"},{default:r(()=>[f(_(G.value.code),1)]),_:1}),o(n(R),{label:"公司"},{default:r(()=>[f(_(G.value.company),1)]),_:1}),o(n(R),{label:"联系人"},{default:r(()=>[f(_(G.value.contact),1)]),_:1}),o(n(R),{label:"国家"},{default:r(()=>[f(_(G.value.country),1)]),_:1}),o(n(R),{label:"产品"},{default:r(()=>[f(_(G.value.product),1)]),_:1}),o(n(R),{label:"状态"},{default:r(()=>[o(n(T),{type:n(y)(G.value.status)},{default:r(()=>[f(_(n(h)(G.value.status)),1)]),_:1},8,["type"])]),_:1}),o(n(R),{label:"邮箱"},{default:r(()=>[f(_(G.value.email||"-"),1)]),_:1}),o(n(R),{label:"电话"},{default:r(()=>[f(_(G.value.phone||"-"),1)]),_:1}),o(n(R),{label:"来源"},{default:r(()=>[f(_(n(k)(G.value.source)),1)]),_:1}),o(n(R),{label:"询盘日期"},{default:r(()=>[f(_(n(g)(G.value.inquiry_date)),1)]),_:1}),o(n(R),{label:"负责人"},{default:r(()=>[f(_(G.value.owner?.name||G.value.owner?.email),1)]),_:1}),o(n(R),{label:"是否录入"},{default:r(()=>[o(n(W),{value:G.value.is_entered,disabled:""},null,8,["value"])]),_:1}),o(n(R),{label:"备注",span:3},{default:r(()=>[f(_(G.value.remark||"-"),1)]),_:1})]),_:1})]),_:1})):p("",!0),o(n(Y),{title:"订单列表"},{"header-extra":r(()=>[o(n(M),{type:"primary",onClick:u[1]||(u[1]=e=>J.value=!0)},{default:r(()=>[...u[7]||(u[7]=[f("新增订单",-1)])]),_:1})]),default:r(()=>[G.value?.orders&&0!==G.value.orders.length?(l(),c(n($),{key:1,columns:Q,data:G.value.orders,pagination:!1},null,8,["data"])):(l(),c(n(Z),{key:0,description:"暂无订单"}))]),_:1}),o(n(Y),{title:"跟进记录"},{"header-extra":r(()=>[o(n(M),{type:"primary",onClick:u[2]||(u[2]=e=>K.value=!0)},{default:r(()=>[...u[8]||(u[8]=[f("添加跟进",-1)])]),_:1})]),default:r(()=>[G.value?.followups&&0!==G.value.followups.length?(l(),c(n(D),{key:1},{default:r(()=>[(l(!0),a(m,null,v(G.value.followups,e=>(l(),c(n(q),{key:e.id,title:n(g)(e.follow_date),type:V(e.method)},{header:r(()=>[o(n(z),null,{default:r(()=>[t("span",null,_(n(g)(e.follow_date)),1),o(n(T),{size:"small",type:V(e.method)},{default:r(()=>[f(_(n(b)(e.method)),1)]),_:2},1032,["type"])]),_:2},1024)]),default:r(()=>[t("p",null,_(e.content),1),e.next_plan?(l(),a("p",P,[u[9]||(u[9]=t("strong",null,"下一步计划：",-1)),f(_(e.next_plan),1)])):p("",!0),o(n(A),{depth:"3"},{default:r(()=>[f(" 跟进人："+_(e.follower?.name||e.follower?.email),1)]),_:2},1024)]),_:2},1032,["title","type"]))),128))]),_:1})):(l(),c(n(Z),{key:0,description:"暂无跟进记录"}))]),_:1})]),_:1})]),_:1},8,["show"]),o(x,{show:H.value,"onUpdate:show":u[3]||(u[3]=e=>H.value=e),customer:G.value,onSuccess:le},null,8,["show","customer"])]))}}),[["__scopeId","data-v-802da408"]]);export{S as default};
