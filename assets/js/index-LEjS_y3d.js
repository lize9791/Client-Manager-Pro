const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Login-E33f139F.js","./vue-vendor-ChRmxV0E.js","./helpers-CM6_8sGB.js","./naive-ui-C-WnQlxP.js","./_plugin-vue_export-helper-DlAUqK2U.js","./supabase-BxUUOEWR.js","../css/Login-DSun2xSl.css","./MainLayout-D-aEbTGq.js","./CustomerFormModal.vue_vue_type_script_setup_true_lang-C6TDuDX5.js","./customer-DlWSUBeS.js","./StatsChartOutline-MKDoyLsD.js","./DocumentTextOutline-DEN2-gad.js","./SearchOutline-DUsqMxOm.js","../css/MainLayout-Djv76iEb.css","./Dashboard-BniM_mpv.js","./TimeOutline-CuTywy_j.js","../css/Dashboard-DnWHpWG7.css","./Customers-CjUyld6r.js","./excel-CPbvKKXA.js","../css/Customers-aOfC-jNo.css","./CustomerDetail-VWdzYe-h.js","../css/CustomerDetail-B_Ri0xd0.css","./Orders-Ckf_6pEN.js","../css/Orders-rOFwk0AH.css","./Reports-BEi9e5s8.js","../css/Reports-FJVRDM2r.css","./Settings-BF5AG5x9.js","../css/Settings-Br-2FF6o.css"])))=>i.map(i=>d[i]);
import{S as T,r as O,c as v,U as D,V as U,k as V,W as q,N as w,X as M,Y as j,Z as A,_ as P,M as B,$ as z}from"./vue-vendor-ChRmxV0E.js";import{c as F}from"./supabase-BxUUOEWR.js";import{N as J,a as k,b as H,c as W,n as Z}from"./naive-ui-C-WnQlxP.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))m(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&m(l)}).observe(document,{childList:!0,subtree:!0});function o(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function m(e){if(e.ep)return;e.ep=!0;const a=o(e);fetch(e.href,a)}})();const Q="modulepreload",X=function(t,i){return new URL(t,i).href},C={},h=function(i,o,m){let e=Promise.resolve();if(o&&o.length>0){const l=document.getElementsByTagName("link"),n=document.querySelector("meta[property=csp-nonce]"),y=n?.nonce||n?.getAttribute("nonce");e=Promise.allSettled(o.map(d=>{if(d=X(d,m),d in C)return;C[d]=!0;const _=d.endsWith(".css"),I=_?'[rel="stylesheet"]':"";if(!!m)for(let r=l.length-1;r>=0;r--){const s=l[r];if(s.href===d&&(!_||s.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${I}`))return;const f=document.createElement("link");if(f.rel=_?"stylesheet":Q,_||(f.as="script"),f.crossOrigin="",f.href=d,y&&f.setAttribute("nonce",y),document.head.appendChild(f),_)return new Promise((r,s)=>{f.addEventListener("load",r),f.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(l){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=l,window.dispatchEvent(n),!n.defaultPrevented)throw l}return e.then(l=>{for(const n of l||[])n.status==="rejected"&&a(n.reason);return i().catch(a)})},Y="https://pqbneojpksizuigsglce.supabase.co",$="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxYm5lb2pwa3NpenVpZ3NnbGNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyODcxMDgsImV4cCI6MjA3Njg2MzEwOH0.lr8G6dn2nTQy4pPQKb7HgVw8Imms71QjDEAPJjB-rjg",p=F(Y,$,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),se={CUSTOMERS:"customers",ORDERS:"orders",FOLLOWUPS:"followups",ATTACHMENTS:"attachments",USERS:"users"},R=T("auth",()=>{const t=O(null),i=O(null),o=O(!1),m=v(()=>!!t.value),e=v(()=>t.value?.role||"viewer"),a=v(()=>e.value==="admin"),l=v(()=>e.value==="sales"),n=v(()=>e.value==="viewer");async function y(){o.value=!0;try{const{data:{session:r}}=await p.auth.getSession();r&&(i.value=r,await d(r.user.id)),p.auth.onAuthStateChange(async(s,u)=>{i.value=u,u?.user?await d(u.user.id):t.value=null})}catch(r){console.error("Failed to initialize auth:",r)}finally{o.value=!1}}async function d(r){try{const{data:s,error:u}=await p.from("users").select("*").eq("id",r).maybeSingle();if(u)throw u;if(s)t.value=s;else{const c=(await p.auth.getUser()).data.user;if(c){const g={id:c.id,email:c.email,name:c.user_metadata?.name||c.email.split("@")[0],role:"sales"},{data:E,error:L}=await p.from("users").insert(g).select().single();L?console.error("Failed to create user profile:",L):t.value=E}}}catch(s){console.error("Failed to fetch user profile:",s)}}async function _(r,s){o.value=!0;try{const{data:u,error:c}=await p.auth.signInWithPassword({email:r,password:s});return c||(i.value=u.session,u.user&&await d(u.user.id),null)}catch(u){return console.error("Sign in error:",u),u}finally{o.value=!1}}async function I(r,s,u){o.value=!0;try{const{data:c,error:g}=await p.auth.signUp({email:r,password:s,options:{data:{name:u}}});if(g)return g;if(c.user){const{error:E}=await p.from("users").insert({id:c.user.id,email:c.user.email,name:u||r.split("@")[0],role:"sales"});E&&console.error("Failed to create user profile:",E)}return null}catch(c){return console.error("Sign up error:",c),c}finally{o.value=!1}}async function b(){o.value=!0;try{await p.auth.signOut(),t.value=null,i.value=null}catch(r){console.error("Sign out error:",r)}finally{o.value=!1}}async function f(r){if(!t.value)return!1;try{const{error:s}=await p.from("users").update(r).eq("id",t.value.id);if(s)throw s;return t.value={...t.value,...r},!0}catch(s){return console.error("Update profile error:",s),!1}}return{user:t,session:i,loading:o,isAuthenticated:m,userRole:e,isAdmin:a,isSales:l,isViewer:n,initialize:y,signIn:_,signUp:I,signOut:b,updateProfile:f}}),G=[{path:"/login",name:"Login",component:()=>h(()=>import("./Login-E33f139F.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url),meta:{requiresAuth:!1}},{path:"/",component:()=>h(()=>import("./MainLayout-D-aEbTGq.js"),__vite__mapDeps([7,1,2,8,9,3,10,11,12,4,5,13]),import.meta.url),meta:{requiresAuth:!0},children:[{path:"",name:"Dashboard",component:()=>h(()=>import("./Dashboard-BniM_mpv.js"),__vite__mapDeps([14,1,2,3,10,15,4,5,16]),import.meta.url)},{path:"customers",name:"Customers",component:()=>h(()=>import("./Customers-CjUyld6r.js"),__vite__mapDeps([17,1,9,2,8,3,18,4,12,5,19]),import.meta.url)},{path:"customers/:id",name:"CustomerDetail",component:()=>h(()=>import("./CustomerDetail-VWdzYe-h.js"),__vite__mapDeps([20,1,9,2,8,3,4,5,21]),import.meta.url)},{path:"orders",name:"Orders",component:()=>h(()=>import("./Orders-Ckf_6pEN.js"),__vite__mapDeps([22,1,9,2,3,12,11,15,4,5,23]),import.meta.url)},{path:"reports",name:"Reports",component:()=>h(()=>import("./Reports-BEi9e5s8.js"),__vite__mapDeps([24,1,3,4,25]),import.meta.url)},{path:"settings",name:"Settings",component:()=>h(()=>import("./Settings-BF5AG5x9.js"),__vite__mapDeps([26,1,3,4,27]),import.meta.url),meta:{requiresAdmin:!0}}]}],N=D({history:U(),routes:G});N.beforeEach(async(t,i,o)=>{const m=R();let e=0;for(;m.loading&&e<30;)await new Promise(n=>setTimeout(n,100)),e++;const a=t.matched.some(n=>n.meta.requiresAuth!==!1),l=t.matched.some(n=>n.meta.requiresAdmin);a&&!m.isAuthenticated?o({name:"Login",query:{redirect:t.fullPath}}):l&&!m.isAdmin?o({name:"Dashboard"}):t.name==="Login"&&m.isAuthenticated?o({name:"Dashboard"}):o()});const K=V({__name:"App",setup(t){const i={common:{primaryColor:"#18a058",primaryColorHover:"#36ad6a",primaryColorPressed:"#0c7a43",primaryColorSuppl:"#36ad6a"}};return(o,m)=>{const e=M("router-view");return j(),q(w(J),{"theme-overrides":i},{default:A(()=>[P(w(k),null,{default:A(()=>[P(w(H),null,{default:A(()=>[P(w(W),null,{default:A(()=>[P(e)]),_:1})]),_:1})]),_:1})]),_:1})}}}),S=B(K),x=z();S.use(x);S.use(N);S.use(Z);const ee=R();ee.initialize().then(()=>{S.mount("#app")});export{se as T,h as _,p as s,R as u};
