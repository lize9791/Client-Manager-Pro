import{d as e,c as a,o as l,n as t,ai as u,u as o,r as s,y as n,b as r,w as d,e as i,am as c,t as p,f as v,R as f,z as _,a3 as m,B as w,m as y,x as h,an as k,ao as b,H as g,S as x,ak as C,N as j,L as B,ad as z,U as M,O as q,ap as I,_ as L,aq as O}from"./index-h22TIHix.js";import{u as S}from"./customer-BaMa2qiP.js";import{c as T,g as U,a as A,f as D,b as F}from"./helpers-Ba1kvV6f.js";import{_ as H}from"./CustomerFormModal.vue_vue_type_script_setup_true_lang-BhgLUkm1.js";import{_ as N}from"./_plugin-vue_export-helper-BCo6x5W8.js";const P={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},R=e({name:"ArrowBackOutline",render:function(e,u){return l(),a("svg",P,u[0]||(u[0]=[t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M244 400L100 256l144-144"},null,-1),t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M120 256h292"},null,-1)]))}}),$={class:"customer-detail-view"},E={key:0},G=N(e({__name:"CustomerDetail",setup(e){const N=v(),P=p(),G=u(),J=o(),K=S(),Q=s(null),V=s(!1),W=s(!1),X=s(!1),Y=[{title:"订单号",key:"order_no"},{title:"产品",key:"product"},{title:"利润",key:"profit"},{title:"状态",key:"status"},{title:"创建日期",key:"create_date",render:e=>D(e.create_date)}];function Z(e){return{email:"info",phone:"success",whatsapp:"success",wechat:"success",meeting:"warning",other:"default"}[e]||"default"}function ee(){V.value=!0}function ae(){Q.value&&G.warning({title:"确认删除",content:`确定要删除客户 "${Q.value.company}" 吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await K.deleteCustomer(Q.value.id),J.success("删除成功"),N.push({name:"Customers"})}catch(e){J.error((null==e?void 0:e.message)||"删除失败")}}})}async function le(){V.value=!1,await te()}async function te(){const e=P.params.id;Q.value=await K.fetchCustomerById(e),Q.value||(J.error("客户不存在"),N.push({name:"Customers"}))}return n(()=>{te()}),(e,u)=>(l(),a("div",$,[r(i(c),{show:i(K).loading},{default:d(()=>[r(i(f),{vertical:"",size:"large"},{default:d(()=>[r(i(w),{text:"",onClick:u[0]||(u[0]=e=>i(N).back())},{icon:d(()=>[r(i(h),{component:i(R)},null,8,["component"])]),default:d(()=>[u[4]||(u[4]=y(" 返回 ",-1))]),_:1}),Q.value?(l(),_(i(j),{key:0,title:"客户信息"},{"header-extra":d(()=>[r(i(f),null,{default:d(()=>[r(i(w),{onClick:ee},{default:d(()=>[...u[5]||(u[5]=[y("编辑",-1)])]),_:1}),r(i(w),{type:"error",onClick:ae},{default:d(()=>[...u[6]||(u[6]=[y("删除",-1)])]),_:1})]),_:1})]),default:d(()=>[r(i(k),{column:3,bordered:""},{default:d(()=>[r(i(b),{label:"客户单号"},{default:d(()=>[y(g(Q.value.code),1)]),_:1}),r(i(b),{label:"公司"},{default:d(()=>[y(g(Q.value.company),1)]),_:1}),r(i(b),{label:"联系人"},{default:d(()=>[y(g(Q.value.contact),1)]),_:1}),r(i(b),{label:"国家"},{default:d(()=>[y(g(Q.value.country),1)]),_:1}),r(i(b),{label:"产品"},{default:d(()=>[y(g(Q.value.product),1)]),_:1}),r(i(b),{label:"状态"},{default:d(()=>[r(i(x),{type:i(T)(Q.value.status)},{default:d(()=>[y(g(i(U)(Q.value.status)),1)]),_:1},8,["type"])]),_:1}),r(i(b),{label:"邮箱"},{default:d(()=>[y(g(Q.value.email||"-"),1)]),_:1}),r(i(b),{label:"电话"},{default:d(()=>[y(g(Q.value.phone||"-"),1)]),_:1}),r(i(b),{label:"来源"},{default:d(()=>[y(g(i(A)(Q.value.source)),1)]),_:1}),r(i(b),{label:"询盘日期"},{default:d(()=>[y(g(i(D)(Q.value.inquiry_date)),1)]),_:1}),r(i(b),{label:"负责人"},{default:d(()=>{var e,a;return[y(g((null==(e=Q.value.owner)?void 0:e.name)||(null==(a=Q.value.owner)?void 0:a.email)),1)]}),_:1}),r(i(b),{label:"是否录入"},{default:d(()=>[r(i(C),{value:Q.value.is_entered,disabled:""},null,8,["value"])]),_:1}),r(i(b),{label:"备注",span:3},{default:d(()=>[y(g(Q.value.remark||"-"),1)]),_:1})]),_:1})]),_:1})):m("",!0),r(i(j),{title:"订单列表"},{"header-extra":d(()=>[r(i(w),{type:"primary",onClick:u[1]||(u[1]=e=>W.value=!0)},{default:d(()=>[...u[7]||(u[7]=[y("新增订单",-1)])]),_:1})]),default:d(()=>{var e;return[(null==(e=Q.value)?void 0:e.orders)&&0!==Q.value.orders.length?(l(),_(i(z),{key:1,columns:Y,data:Q.value.orders,pagination:!1},null,8,["data"])):(l(),_(i(B),{key:0,description:"暂无订单"}))]}),_:1}),r(i(j),{title:"跟进记录"},{"header-extra":d(()=>[r(i(w),{type:"primary",onClick:u[2]||(u[2]=e=>X.value=!0)},{default:d(()=>[...u[8]||(u[8]=[y("添加跟进",-1)])]),_:1})]),default:d(()=>{var e;return[(null==(e=Q.value)?void 0:e.followups)&&0!==Q.value.followups.length?(l(),_(i(O),{key:1},{default:d(()=>[(l(!0),a(M,null,q(Q.value.followups,e=>(l(),_(i(I),{key:e.id,title:i(D)(e.follow_date),type:Z(e.method)},{header:d(()=>[r(i(f),null,{default:d(()=>[t("span",null,g(i(D)(e.follow_date)),1),r(i(x),{size:"small",type:Z(e.method)},{default:d(()=>[y(g(i(F)(e.method)),1)]),_:2},1032,["type"])]),_:2},1024)]),default:d(()=>[t("p",null,g(e.content),1),e.next_plan?(l(),a("p",E,[u[9]||(u[9]=t("strong",null,"下一步计划：",-1)),y(g(e.next_plan),1)])):m("",!0),r(i(L),{depth:"3"},{default:d(()=>{var a,l;return[y(" 跟进人："+g((null==(a=e.follower)?void 0:a.name)||(null==(l=e.follower)?void 0:l.email)),1)]}),_:2},1024)]),_:2},1032,["title","type"]))),128))]),_:1})):(l(),_(i(B),{key:0,description:"暂无跟进记录"}))]}),_:1})]),_:1})]),_:1},8,["show"]),r(H,{show:V.value,"onUpdate:show":u[3]||(u[3]=e=>V.value=e),customer:Q.value,onSuccess:le},null,8,["show","customer"])]))}}),[["__scopeId","data-v-802da408"]]);export{G as default};
