import{u as e}from"./customer-BCGf-V4o.js";import{e as a,v as l}from"./helpers-Ba1kvV6f.js";import{d as t,u,r as o,q as r,ar as s,z as n,w as d,e as i,a2 as v,o as c,b as p,Y as m,as as h,k as _,at as b,ac as f,ak as g,J as y,i as w,B as q,m as U,H as k,R as x}from"./index-BgS45tSZ.js";const C=t({__name:"CustomerFormModal",props:{show:{type:Boolean,default:!1},customer:{default:null}},emits:["update:show","success"],setup(t,{emit:C}){const S=t,j=C,D=u(),M=e(),B=o(null),F=o(!1),I=r({get:()=>S.show,set:e=>j("update:show",e)}),O=r(()=>!!S.customer),R=o({code:"",inquiry_date:(new Date).toISOString().split("T")[0],company:"",contact:"",country:"",product:"",email:"",phone:"",source:"other",follow_method:void 0,status:"new",is_entered:!1,remark:""}),T=[{label:"网站",value:"website"},{label:"邮件",value:"email"},{label:"展会",value:"exhibition"},{label:"转介绍",value:"referral"},{label:"电话营销",value:"cold_call"},{label:"社交媒体",value:"social_media"},{label:"其他",value:"other"}],V=[{label:"邮件",value:"email"},{label:"电话",value:"phone"},{label:"WhatsApp",value:"whatsapp"},{label:"微信",value:"wechat"},{label:"会议",value:"meeting"},{label:"其他",value:"other"}],z=[{label:"样品已成交",value:"sample_won"},{label:"洽谈中",value:"negotiating"},{label:"排产中",value:"in_production"},{label:"已完成",value:"completed"},{label:"新一轮洽谈",value:"new_round"},{label:"已被他人成交",value:"won_by_others"},{label:"潜在客户",value:"potential"},{label:"高价值客户",value:"high_value"},{label:"无回复",value:"no_response"},{label:"不可执行",value:"not_executable"},{label:"低优先级",value:"low_priority"}],A={code:{required:!0,message:"请输入客户单号",trigger:"blur"},inquiry_date:{required:!0,message:"请选择询盘日期",trigger:"blur"},company:{required:!0,message:"请输入公司名称",trigger:"blur"},contact:{required:!0,message:"请输入联系人",trigger:"blur"},country:{required:!0,message:"请输入国家/地区",trigger:"blur"},product:{required:!0,message:"请输入产品",trigger:"blur"},source:{required:!0,message:"请选择客户来源",trigger:"change"},status:{required:!0,message:"请选择客户状态",trigger:"change"},email:{validator:(e,a)=>!a||l(a),message:"请输入有效的邮箱地址",trigger:"blur"},phone:{validator:(e,l)=>!l||a(l),message:"请输入有效的电话号码",trigger:"blur"}};function H(){R.value={code:`CUS${Date.now()}`,inquiry_date:(new Date).toISOString().split("T")[0],company:"",contact:"",country:"",product:"",email:"",phone:"",source:"other",follow_method:void 0,status:"new",is_entered:!1,remark:""}}async function J(){if(B.value)try{await B.value.validate(),F.value=!0,O.value&&S.customer?(await M.updateCustomer(S.customer.id,R.value),D.success("客户更新成功")):(await M.createCustomer(R.value),D.success("客户创建成功")),j("success"),W()}catch(e){if(e?.errorFields)return;D.error(e?.message||"操作失败")}finally{F.value=!1}}function W(){H(),B.value?.restoreValidation(),j("update:show",!1)}return s(()=>S.customer,e=>{e?R.value={code:e.code,inquiry_date:e.inquiry_date,company:e.company,contact:e.contact,country:e.country,product:e.product,email:e.email||"",phone:e.phone||"",source:e.source,follow_method:e.follow_method,status:e.status,is_entered:e.is_entered,remark:e.remark||""}:H()},{immediate:!0}),(e,a)=>{const l=y("n-form-item");return c(),n(i(v),{show:I.value,"onUpdate:show":[a[13]||(a[13]=e=>I.value=e),W],"mask-closable":!1,preset:"card",title:O.value?"编辑客户":"新增客户",style:{width:"800px"}},{footer:d(()=>[p(i(x),{justify:"end"},{default:d(()=>[p(i(q),{onClick:W},{default:d(()=>[...a[14]||(a[14]=[U("取消",-1)])]),_:1}),p(i(q),{type:"primary",loading:F.value,onClick:J},{default:d(()=>[U(k(O.value?"保存":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:d(()=>[p(i(w),{ref_key:"formRef",ref:B,model:R.value,rules:A,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:d(()=>[p(i(m),{cols:2,"x-gap":24},{default:d(()=>[p(i(h),{label:"客户单号",path:"code"},{default:d(()=>[p(i(_),{value:R.value.code,"onUpdate:value":a[0]||(a[0]=e=>R.value.code=e),placeholder:"自动生成或手动输入"},null,8,["value"])]),_:1}),p(i(h),{label:"询盘日期",path:"inquiry_date"},{default:d(()=>[p(i(b),{"formatted-value":R.value.inquiry_date,"onUpdate:formattedValue":a[1]||(a[1]=e=>R.value.inquiry_date=e),type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),p(i(h),{label:"公司名称",path:"company"},{default:d(()=>[p(i(_),{value:R.value.company,"onUpdate:value":a[2]||(a[2]=e=>R.value.company=e),placeholder:"请输入公司名称"},null,8,["value"])]),_:1}),p(i(h),{label:"联系人",path:"contact"},{default:d(()=>[p(i(_),{value:R.value.contact,"onUpdate:value":a[3]||(a[3]=e=>R.value.contact=e),placeholder:"请输入联系人姓名"},null,8,["value"])]),_:1}),p(i(h),{label:"国家/地区",path:"country"},{default:d(()=>[p(i(_),{value:R.value.country,"onUpdate:value":a[4]||(a[4]=e=>R.value.country=e),placeholder:"如: 美国, 中国"},null,8,["value"])]),_:1}),p(i(h),{label:"产品",path:"product"},{default:d(()=>[p(i(_),{value:R.value.product,"onUpdate:value":a[5]||(a[5]=e=>R.value.product=e),placeholder:"请输入产品名称"},null,8,["value"])]),_:1}),p(i(h),{label:"邮箱",path:"email"},{default:d(()=>[p(i(_),{value:R.value.email,"onUpdate:value":a[6]||(a[6]=e=>R.value.email=e),placeholder:"请输入邮箱地址"},null,8,["value"])]),_:1}),p(i(h),{label:"电话",path:"phone"},{default:d(()=>[p(i(_),{value:R.value.phone,"onUpdate:value":a[7]||(a[7]=e=>R.value.phone=e),placeholder:"请输入电话号码"},null,8,["value"])]),_:1}),p(i(h),{label:"客户来源",path:"source"},{default:d(()=>[p(i(f),{value:R.value.source,"onUpdate:value":a[8]||(a[8]=e=>R.value.source=e),options:T},null,8,["value"])]),_:1}),p(i(h),{label:"跟进方式",path:"follow_method"},{default:d(()=>[p(i(f),{value:R.value.follow_method,"onUpdate:value":a[9]||(a[9]=e=>R.value.follow_method=e),options:V},null,8,["value"])]),_:1}),p(i(h),{label:"客户状态",path:"status"},{default:d(()=>[p(i(f),{value:R.value.status,"onUpdate:value":a[10]||(a[10]=e=>R.value.status=e),options:z},null,8,["value"])]),_:1}),p(i(h),{label:"是否录入",path:"is_entered"},{default:d(()=>[p(i(g),{value:R.value.is_entered,"onUpdate:value":a[11]||(a[11]=e=>R.value.is_entered=e)},null,8,["value"])]),_:1})]),_:1}),p(l,{label:"备注",path:"remark"},{default:d(()=>[p(i(_),{value:R.value.remark,"onUpdate:value":a[12]||(a[12]=e=>R.value.remark=e),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}});export{C as _};
