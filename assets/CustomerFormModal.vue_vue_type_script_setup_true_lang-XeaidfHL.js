import{u as O}from"./customer-BPUWG0Bc.js";import{e as I,v as V}from"./helpers-CM6_8sGB.js";import{u as T,H as j,C as E,a1 as s,i as n,a2 as G,Q as b,X as P,g as R,B as w,y as W}from"./naive-ui-C-WnQlxP.js";import{k as X,r as g,c as q,w as A,W as H,Z as r,N as l,Y as Q,_ as t,X as Y,j as k,a5 as Z}from"./vue-vendor-ChRmxV0E.js";const L=X({__name:"CustomerFormModal",props:{show:{type:Boolean,default:!1},customer:{default:null}},emits:["update:show","success"],setup(U,{emit:N}){const i=U,v=N,p=T(),y=O(),d=g(null),m=g(!1),h=q({get:()=>i.show,set:o=>v("update:show",o)}),c=q(()=>!!i.customer),a=g({code:"",inquiry_date:new Date().toISOString().split("T")[0],company:"",contact:"",country:"",product:"",email:"",phone:"",source:"other",follow_method:void 0,status:"new",is_entered:!1,remark:""}),S=[{label:"网站",value:"website"},{label:"邮件",value:"email"},{label:"展会",value:"exhibition"},{label:"转介绍",value:"referral"},{label:"电话营销",value:"cold_call"},{label:"社交媒体",value:"social_media"},{label:"其他",value:"other"}],x=[{label:"邮件",value:"email"},{label:"电话",value:"phone"},{label:"WhatsApp",value:"whatsapp"},{label:"微信",value:"wechat"},{label:"会议",value:"meeting"},{label:"其他",value:"other"}],D=[{label:"样品已成交",value:"sample_won"},{label:"洽谈中",value:"negotiating"},{label:"排产中",value:"in_production"},{label:"已完成",value:"completed"},{label:"新一轮洽谈",value:"new_round"},{label:"已被他人成交",value:"won_by_others"},{label:"潜在客户",value:"potential"},{label:"高价值客户",value:"high_value"},{label:"无回复",value:"no_response"},{label:"不可执行",value:"not_executable"},{label:"低优先级",value:"low_priority"}],M={code:{required:!0,message:"请输入客户单号",trigger:"blur"},inquiry_date:{required:!0,message:"请选择询盘日期",trigger:"blur"},company:{required:!0,message:"请输入公司名称",trigger:"blur"},contact:{required:!0,message:"请输入联系人",trigger:"blur"},country:{required:!0,message:"请输入国家/地区",trigger:"blur"},product:{required:!0,message:"请输入产品",trigger:"blur"},source:{required:!0,message:"请选择客户来源",trigger:"change"},status:{required:!0,message:"请选择客户状态",trigger:"change"},email:{validator:(o,e)=>e?V(e):!0,message:"请输入有效的邮箱地址",trigger:"blur"},phone:{validator:(o,e)=>e?I(e):!0,message:"请输入有效的电话号码",trigger:"blur"}};A(()=>i.customer,o=>{o?a.value={code:o.code,inquiry_date:o.inquiry_date,company:o.company,contact:o.contact,country:o.country,product:o.product,email:o.email||"",phone:o.phone||"",source:o.source,follow_method:o.follow_method,status:o.status,is_entered:o.is_entered,remark:o.remark||""}:_()},{immediate:!0});function _(){a.value={code:`CUS${Date.now()}`,inquiry_date:new Date().toISOString().split("T")[0],company:"",contact:"",country:"",product:"",email:"",phone:"",source:"other",follow_method:void 0,status:"new",is_entered:!1,remark:""}}async function B(){if(d.value)try{await d.value.validate(),m.value=!0,c.value&&i.customer?(await y.updateCustomer(i.customer.id,a.value),p.success("客户更新成功")):(await y.createCustomer(a.value),p.success("客户创建成功")),v("success"),f()}catch(o){if(o?.errorFields)return;p.error(o?.message||"操作失败")}finally{m.value=!1}}function f(){_(),d.value?.restoreValidation(),v("update:show",!1)}return(o,e)=>{const F=Y("n-form-item");return Q(),H(l(j),{show:h.value,"onUpdate:show":[e[13]||(e[13]=u=>h.value=u),f],"mask-closable":!1,preset:"card",title:c.value?"编辑客户":"新增客户",style:{width:"800px"}},{footer:r(()=>[t(l(W),{justify:"end"},{default:r(()=>[t(l(w),{onClick:f},{default:r(()=>[...e[14]||(e[14]=[k("取消",-1)])]),_:1}),t(l(w),{type:"primary",loading:m.value,onClick:B},{default:r(()=>[k(Z(c.value?"保存":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:r(()=>[t(l(R),{ref_key:"formRef",ref:d,model:a.value,rules:M,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:r(()=>[t(l(E),{cols:2,"x-gap":24},{default:r(()=>[t(l(s),{label:"客户单号",path:"code"},{default:r(()=>[t(l(n),{value:a.value.code,"onUpdate:value":e[0]||(e[0]=u=>a.value.code=u),placeholder:"自动生成或手动输入"},null,8,["value"])]),_:1}),t(l(s),{label:"询盘日期",path:"inquiry_date"},{default:r(()=>[t(l(G),{"formatted-value":a.value.inquiry_date,"onUpdate:formattedValue":e[1]||(e[1]=u=>a.value.inquiry_date=u),type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),t(l(s),{label:"公司名称",path:"company"},{default:r(()=>[t(l(n),{value:a.value.company,"onUpdate:value":e[2]||(e[2]=u=>a.value.company=u),placeholder:"请输入公司名称"},null,8,["value"])]),_:1}),t(l(s),{label:"联系人",path:"contact"},{default:r(()=>[t(l(n),{value:a.value.contact,"onUpdate:value":e[3]||(e[3]=u=>a.value.contact=u),placeholder:"请输入联系人姓名"},null,8,["value"])]),_:1}),t(l(s),{label:"国家/地区",path:"country"},{default:r(()=>[t(l(n),{value:a.value.country,"onUpdate:value":e[4]||(e[4]=u=>a.value.country=u),placeholder:"如: 美国, 中国"},null,8,["value"])]),_:1}),t(l(s),{label:"产品",path:"product"},{default:r(()=>[t(l(n),{value:a.value.product,"onUpdate:value":e[5]||(e[5]=u=>a.value.product=u),placeholder:"请输入产品名称"},null,8,["value"])]),_:1}),t(l(s),{label:"邮箱",path:"email"},{default:r(()=>[t(l(n),{value:a.value.email,"onUpdate:value":e[6]||(e[6]=u=>a.value.email=u),placeholder:"请输入邮箱地址"},null,8,["value"])]),_:1}),t(l(s),{label:"电话",path:"phone"},{default:r(()=>[t(l(n),{value:a.value.phone,"onUpdate:value":e[7]||(e[7]=u=>a.value.phone=u),placeholder:"请输入电话号码"},null,8,["value"])]),_:1}),t(l(s),{label:"客户来源",path:"source"},{default:r(()=>[t(l(b),{value:a.value.source,"onUpdate:value":e[8]||(e[8]=u=>a.value.source=u),options:S},null,8,["value"])]),_:1}),t(l(s),{label:"跟进方式",path:"follow_method"},{default:r(()=>[t(l(b),{value:a.value.follow_method,"onUpdate:value":e[9]||(e[9]=u=>a.value.follow_method=u),options:x},null,8,["value"])]),_:1}),t(l(s),{label:"客户状态",path:"status"},{default:r(()=>[t(l(b),{value:a.value.status,"onUpdate:value":e[10]||(e[10]=u=>a.value.status=u),options:D},null,8,["value"])]),_:1}),t(l(s),{label:"是否录入",path:"is_entered"},{default:r(()=>[t(l(P),{value:a.value.is_entered,"onUpdate:value":e[11]||(e[11]=u=>a.value.is_entered=u)},null,8,["value"])]),_:1})]),_:1}),t(F,{label:"备注",path:"remark"},{default:r(()=>[t(l(n),{value:a.value.remark,"onUpdate:value":e[12]||(e[12]=u=>a.value.remark=u),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}});export{L as _};
//# sourceMappingURL=CustomerFormModal.vue_vue_type_script_setup_true_lang-XeaidfHL.js.map
