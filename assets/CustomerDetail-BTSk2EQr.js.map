{"version":3,"file":"CustomerDetail-BTSk2EQr.js","sources":["../../node_modules/@vicons/ionicons5/es/ArrowBackOutline.js","../../src/views/CustomerDetail.vue"],"sourcesContent":["import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nexport default defineComponent({\n  name: 'ArrowBackOutline',\n  render: function render(_ctx, _cache) {\n    return (\n      _openBlock(),\n      _createElementBlock(\n        'svg',\n        _hoisted_1,\n        _cache[0] ||\n          (_cache[0] = [\n            _createElementVNode(\n              'path',\n              {\n                fill: 'none',\n                stroke: 'currentColor',\n                'stroke-linecap': 'round',\n                'stroke-linejoin': 'round',\n                'stroke-width': '48',\n                d: 'M244 400L100 256l144-144'\n              },\n              null,\n              -1 /* HOISTED */\n            ),\n            _createElementVNode(\n              'path',\n              {\n                fill: 'none',\n                stroke: 'currentColor',\n                'stroke-linecap': 'round',\n                'stroke-linejoin': 'round',\n                'stroke-width': '48',\n                d: 'M120 256h292'\n              },\n              null,\n              -1 /* HOISTED */\n            )\n          ])\n      )\n    )\n  }\n})\n","<template>\n  <div class=\"customer-detail-view\">\n    <n-spin :show=\"customerStore.loading\">\n      <n-space vertical size=\"large\">\n        <!-- 返回按钮 -->\n        <n-button text @click=\"router.back()\">\n          <template #icon>\n            <n-icon :component=\"ArrowBackOutline\" />\n          </template>\n          返回\n        </n-button>\n\n        <!-- 客户基本信息 -->\n        <n-card v-if=\"customer\" title=\"客户信息\">\n          <template #header-extra>\n            <n-space>\n              <n-button @click=\"handleEdit\">编辑</n-button>\n              <n-button type=\"error\" @click=\"handleDelete\">删除</n-button>\n            </n-space>\n          </template>\n\n          <n-descriptions :column=\"3\" bordered>\n            <n-descriptions-item label=\"客户单号\">{{ customer.code }}</n-descriptions-item>\n            <n-descriptions-item label=\"公司\">{{ customer.company }}</n-descriptions-item>\n            <n-descriptions-item label=\"联系人\">{{ customer.contact }}</n-descriptions-item>\n            <n-descriptions-item label=\"国家\">{{ customer.country }}</n-descriptions-item>\n            <n-descriptions-item label=\"产品\">{{ customer.product }}</n-descriptions-item>\n            <n-descriptions-item label=\"状态\">\n              <n-tag :type=\"getStatusType(customer.status)\">\n                {{ getStatusLabel(customer.status) }}\n              </n-tag>\n            </n-descriptions-item>\n            <n-descriptions-item label=\"邮箱\">{{ customer.email || '-' }}</n-descriptions-item>\n            <n-descriptions-item label=\"电话\">{{ customer.phone || '-' }}</n-descriptions-item>\n            <n-descriptions-item label=\"来源\">\n              {{ getSourceLabel(customer.source) }}\n            </n-descriptions-item>\n            <n-descriptions-item label=\"询盘日期\">\n              {{ formatDate(customer.inquiry_date) }}\n            </n-descriptions-item>\n            <n-descriptions-item label=\"负责人\">\n              {{ customer.owner?.name || customer.owner?.email }}\n            </n-descriptions-item>\n            <n-descriptions-item label=\"是否录入\">\n              <n-switch :value=\"customer.is_entered\" disabled />\n            </n-descriptions-item>\n            <n-descriptions-item label=\"备注\" :span=\"3\">\n              {{ customer.remark || '-' }}\n            </n-descriptions-item>\n          </n-descriptions>\n        </n-card>\n\n        <!-- 订单列表 -->\n        <n-card title=\"订单列表\">\n          <template #header-extra>\n            <n-button type=\"primary\" @click=\"showAddOrder = true\">新增订单</n-button>\n          </template>\n\n          <n-empty v-if=\"!customer?.orders || customer.orders.length === 0\" description=\"暂无订单\" />\n          <n-data-table v-else :columns=\"orderColumns\" :data=\"customer.orders\" :pagination=\"false\" />\n        </n-card>\n\n        <!-- 跟进记录 -->\n        <n-card title=\"跟进记录\">\n          <template #header-extra>\n            <n-button type=\"primary\" @click=\"showAddFollowup = true\">添加跟进</n-button>\n          </template>\n\n          <n-empty\n            v-if=\"!customer?.followups || customer.followups.length === 0\"\n            description=\"暂无跟进记录\"\n          />\n          <n-timeline v-else>\n            <n-timeline-item\n              v-for=\"followup in customer.followups\"\n              :key=\"followup.id\"\n              :title=\"formatDate(followup.follow_date)\"\n              :type=\"getFollowupType(followup.method)\"\n            >\n              <template #header>\n                <n-space>\n                  <span>{{ formatDate(followup.follow_date) }}</span>\n                  <n-tag size=\"small\" :type=\"getFollowupType(followup.method)\">\n                    {{ getMethodLabel(followup.method) }}\n                  </n-tag>\n                </n-space>\n              </template>\n              <p>{{ followup.content }}</p>\n              <p v-if=\"followup.next_plan\">\n                <strong>下一步计划：</strong>{{ followup.next_plan }}\n              </p>\n              <n-text depth=\"3\">\n                跟进人：{{ followup.follower?.name || followup.follower?.email }}\n              </n-text>\n            </n-timeline-item>\n          </n-timeline>\n        </n-card>\n      </n-space>\n    </n-spin>\n\n    <!-- 编辑客户 -->\n    <customer-form-modal\n      v-model:show=\"showEdit\"\n      :customer=\"customer\"\n      @success=\"handleUpdateSuccess\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport {\n  NSpin,\n  NSpace,\n  NButton,\n  NIcon,\n  NCard,\n  NDescriptions,\n  NDescriptionsItem,\n  NTag,\n  NSwitch,\n  NEmpty,\n  NDataTable,\n  NTimeline,\n  NTimelineItem,\n  NText,\n  useDialog,\n  useMessage,\n  type DataTableColumns\n} from 'naive-ui'\nimport { ArrowBackOutline } from '@vicons/ionicons5'\nimport { useCustomerStore } from '@/stores/customer'\nimport { formatDate, getStatusLabel, getStatusType, getMethodLabel, getSourceLabel } from '@/utils/helpers'\nimport type { Customer, Order } from '@/types'\nimport CustomerFormModal from '@/components/CustomerFormModal.vue'\n\nconst router = useRouter()\nconst route = useRoute()\nconst dialog = useDialog()\nconst message = useMessage()\nconst customerStore = useCustomerStore()\n\nconst customer = ref<Customer | null>(null)\nconst showEdit = ref(false)\nconst showAddOrder = ref(false)\nconst showAddFollowup = ref(false)\n\nconst orderColumns: DataTableColumns<Order> = [\n  { title: '订单号', key: 'order_no' },\n  { title: '产品', key: 'product' },\n  { title: '利润', key: 'profit' },\n  { title: '状态', key: 'status' },\n  { title: '创建日期', key: 'create_date', render: row => formatDate(row.create_date) }\n]\n\nfunction getFollowupType(method: string): 'success' | 'info' | 'warning' | 'error' {\n  const map: Record<string, any> = {\n    email: 'info',\n    phone: 'success',\n    whatsapp: 'success',\n    wechat: 'success',\n    meeting: 'warning',\n    other: 'default'\n  }\n  return map[method] || 'default'\n}\n\nfunction handleEdit() {\n  showEdit.value = true\n}\n\nfunction handleDelete() {\n  if (!customer.value) return\n\n  dialog.warning({\n    title: '确认删除',\n    content: `确定要删除客户 \"${customer.value.company}\" 吗？此操作不可恢复。`,\n    positiveText: '删除',\n    negativeText: '取消',\n    onPositiveClick: async () => {\n      try {\n        await customerStore.deleteCustomer(customer.value!.id)\n        message.success('删除成功')\n        router.push({ name: 'Customers' })\n      } catch (error: any) {\n        message.error(error?.message || '删除失败')\n      }\n    }\n  })\n}\n\nasync function handleUpdateSuccess() {\n  showEdit.value = false\n  await loadCustomer()\n}\n\nasync function loadCustomer() {\n  const id = route.params.id as string\n  customer.value = await customerStore.fetchCustomerById(id)\n\n  if (!customer.value) {\n    message.error('客户不存在')\n    router.push({ name: 'Customers' })\n  }\n}\n\nonMounted(() => {\n  loadCustomer()\n})\n</script>\n\n<style scoped>\n.customer-detail-view {\n  height: 100%;\n  overflow-y: auto;\n}\n</style>\n"],"names":["_hoisted_1","ArrowBackOutline","defineComponent","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","router","useRouter","route","useRoute","dialog","useDialog","message","useMessage","customerStore","useCustomerStore","customer","ref","showEdit","showAddOrder","showAddFollowup","orderColumns","row","formatDate","getFollowupType","method","handleEdit","handleDelete","error","handleUpdateSuccess","loadCustomer","id","onMounted","_createVNode","_unref","NSpin","NSpace","NButton","$event","NIcon","_createBlock","NCard","NDescriptions","NDescriptionsItem","_createTextVNode","_toDisplayString","NTag","getStatusType","getStatusLabel","getSourceLabel","NSwitch","NEmpty","NDataTable","NTimeline","_Fragment","_renderList","followup","NTimelineItem","getMethodLabel","_hoisted_2","NText","CustomerFormModal"],"mappings":"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","x_google_ignoreList":[0]}