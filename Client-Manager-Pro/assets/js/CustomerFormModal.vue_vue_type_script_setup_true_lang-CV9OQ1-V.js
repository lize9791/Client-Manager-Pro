import{u as e}from"./customer-yRo_pr2K.js";import{e as a,v as l}from"./helpers-Ba1kvV6f.js";import{u as t,H as u,C as o,a1 as r,i as s,a2 as n,Q as d,X as i,g as v,B as c,y as p}from"./naive-ui-DL6zjJD3.js";import{k as m,r as h,c as _,w as b,W as f,Z as g,N as y,Y as w,_ as q,X as U,j as k,a5 as x}from"./vue-vendor-AGKXruha.js";const C=m({__name:"CustomerFormModal",props:{show:{type:Boolean,default:!1},customer:{default:null}},emits:["update:show","success"],setup(m,{emit:C}){const j=m,S=C,D=t(),M=e(),B=h(null),F=h(!1),I=_({get:()=>j.show,set:e=>S("update:show",e)}),O=_(()=>!!j.customer),T=h({code:"",inquiry_date:(new Date).toISOString().split("T")[0],company:"",contact:"",country:"",product:"",email:"",phone:"",source:"other",follow_method:void 0,status:"new",is_entered:!1,remark:""}),V=[{label:"网站",value:"website"},{label:"邮件",value:"email"},{label:"展会",value:"exhibition"},{label:"转介绍",value:"referral"},{label:"电话营销",value:"cold_call"},{label:"社交媒体",value:"social_media"},{label:"其他",value:"other"}],W=[{label:"邮件",value:"email"},{label:"电话",value:"phone"},{label:"WhatsApp",value:"whatsapp"},{label:"微信",value:"wechat"},{label:"会议",value:"meeting"},{label:"其他",value:"other"}],X=[{label:"样品已成交",value:"sample_won"},{label:"洽谈中",value:"negotiating"},{label:"排产中",value:"in_production"},{label:"已完成",value:"completed"},{label:"新一轮洽谈",value:"new_round"},{label:"已被他人成交",value:"won_by_others"},{label:"潜在客户",value:"potential"},{label:"高价值客户",value:"high_value"},{label:"无回复",value:"no_response"},{label:"不可执行",value:"not_executable"},{label:"低优先级",value:"low_priority"}],A={code:{required:!0,message:"请输入客户单号",trigger:"blur"},inquiry_date:{required:!0,message:"请选择询盘日期",trigger:"blur"},company:{required:!0,message:"请输入公司名称",trigger:"blur"},contact:{required:!0,message:"请输入联系人",trigger:"blur"},country:{required:!0,message:"请输入国家/地区",trigger:"blur"},product:{required:!0,message:"请输入产品",trigger:"blur"},source:{required:!0,message:"请选择客户来源",trigger:"change"},status:{required:!0,message:"请选择客户状态",trigger:"change"},email:{validator:(e,a)=>!a||l(a),message:"请输入有效的邮箱地址",trigger:"blur"},phone:{validator:(e,l)=>!l||a(l),message:"请输入有效的电话号码",trigger:"blur"}};function H(){T.value={code:`CUS${Date.now()}`,inquiry_date:(new Date).toISOString().split("T")[0],company:"",contact:"",country:"",product:"",email:"",phone:"",source:"other",follow_method:void 0,status:"new",is_entered:!1,remark:""}}async function N(){if(B.value)try{await B.value.validate(),F.value=!0,O.value&&j.customer?(await M.updateCustomer(j.customer.id,T.value),D.success("客户更新成功")):(await M.createCustomer(T.value),D.success("客户创建成功")),S("success"),Q()}catch(e){if(e?.errorFields)return;D.error(e?.message||"操作失败")}finally{F.value=!1}}function Q(){H(),B.value?.restoreValidation(),S("update:show",!1)}return b(()=>j.customer,e=>{e?T.value={code:e.code,inquiry_date:e.inquiry_date,company:e.company,contact:e.contact,country:e.country,product:e.product,email:e.email||"",phone:e.phone||"",source:e.source,follow_method:e.follow_method,status:e.status,is_entered:e.is_entered,remark:e.remark||""}:H()},{immediate:!0}),(e,a)=>{const l=U("n-form-item");return w(),f(y(u),{show:I.value,"onUpdate:show":[a[13]||(a[13]=e=>I.value=e),Q],"mask-closable":!1,preset:"card",title:O.value?"编辑客户":"新增客户",style:{width:"800px"}},{footer:g(()=>[q(y(p),{justify:"end"},{default:g(()=>[q(y(c),{onClick:Q},{default:g(()=>[...a[14]||(a[14]=[k("取消",-1)])]),_:1}),q(y(c),{type:"primary",loading:F.value,onClick:N},{default:g(()=>[k(x(O.value?"保存":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:g(()=>[q(y(v),{ref_key:"formRef",ref:B,model:T.value,rules:A,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:g(()=>[q(y(o),{cols:2,"x-gap":24},{default:g(()=>[q(y(r),{label:"客户单号",path:"code"},{default:g(()=>[q(y(s),{value:T.value.code,"onUpdate:value":a[0]||(a[0]=e=>T.value.code=e),placeholder:"自动生成或手动输入"},null,8,["value"])]),_:1}),q(y(r),{label:"询盘日期",path:"inquiry_date"},{default:g(()=>[q(y(n),{"formatted-value":T.value.inquiry_date,"onUpdate:formattedValue":a[1]||(a[1]=e=>T.value.inquiry_date=e),type:"date","value-format":"yyyy-MM-dd",style:{width:"100%"}},null,8,["formatted-value"])]),_:1}),q(y(r),{label:"公司名称",path:"company"},{default:g(()=>[q(y(s),{value:T.value.company,"onUpdate:value":a[2]||(a[2]=e=>T.value.company=e),placeholder:"请输入公司名称"},null,8,["value"])]),_:1}),q(y(r),{label:"联系人",path:"contact"},{default:g(()=>[q(y(s),{value:T.value.contact,"onUpdate:value":a[3]||(a[3]=e=>T.value.contact=e),placeholder:"请输入联系人姓名"},null,8,["value"])]),_:1}),q(y(r),{label:"国家/地区",path:"country"},{default:g(()=>[q(y(s),{value:T.value.country,"onUpdate:value":a[4]||(a[4]=e=>T.value.country=e),placeholder:"如: 美国, 中国"},null,8,["value"])]),_:1}),q(y(r),{label:"产品",path:"product"},{default:g(()=>[q(y(s),{value:T.value.product,"onUpdate:value":a[5]||(a[5]=e=>T.value.product=e),placeholder:"请输入产品名称"},null,8,["value"])]),_:1}),q(y(r),{label:"邮箱",path:"email"},{default:g(()=>[q(y(s),{value:T.value.email,"onUpdate:value":a[6]||(a[6]=e=>T.value.email=e),placeholder:"请输入邮箱地址"},null,8,["value"])]),_:1}),q(y(r),{label:"电话",path:"phone"},{default:g(()=>[q(y(s),{value:T.value.phone,"onUpdate:value":a[7]||(a[7]=e=>T.value.phone=e),placeholder:"请输入电话号码"},null,8,["value"])]),_:1}),q(y(r),{label:"客户来源",path:"source"},{default:g(()=>[q(y(d),{value:T.value.source,"onUpdate:value":a[8]||(a[8]=e=>T.value.source=e),options:V},null,8,["value"])]),_:1}),q(y(r),{label:"跟进方式",path:"follow_method"},{default:g(()=>[q(y(d),{value:T.value.follow_method,"onUpdate:value":a[9]||(a[9]=e=>T.value.follow_method=e),options:W},null,8,["value"])]),_:1}),q(y(r),{label:"客户状态",path:"status"},{default:g(()=>[q(y(d),{value:T.value.status,"onUpdate:value":a[10]||(a[10]=e=>T.value.status=e),options:X},null,8,["value"])]),_:1}),q(y(r),{label:"是否录入",path:"is_entered"},{default:g(()=>[q(y(i),{value:T.value.is_entered,"onUpdate:value":a[11]||(a[11]=e=>T.value.is_entered=e)},null,8,["value"])]),_:1})]),_:1}),q(l,{label:"备注",path:"remark"},{default:g(()=>[q(y(s),{value:T.value.remark,"onUpdate:value":a[12]||(a[12]=e=>T.value.remark=e),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}});export{C as _};
